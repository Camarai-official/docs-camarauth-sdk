---
title: "API Reference (Swagger)"
description: "Documentaci√≥n interactiva de la API REST"
---

# API Reference

## Swagger UI

Explora y prueba la API de Camarauth de forma interactiva usando Swagger UI.

<Card
  title="Ver Swagger UI"
  icon="document"
  href="https://petstore.swagger.io/?url=https://raw.githubusercontent.com/camarauth/camarauth-sdk/main/swagger.yaml"
>
  Abre el Swagger UI con la especificaci√≥n completa de la API
</Card>

## Endpoints principales

### Health Check

```http
GET /health
```

Verifica que el servidor est√° funcionando.

**Respuesta:**

```json
{
  "status": "ok",
  "timestamp": "2024-01-01T00:00:00.000Z",
  "activePins": 0,
  "instance": "mi-instancia"
}
```

### Registrar PIN

```http
POST /register-pin
Content-Type: application/json

{
  "pin": "ABC123",
  "emojiString": "üîêüîëüîí"
}
```

Registra un nuevo PIN para autenticaci√≥n.

**Respuesta:**

```json
{
  "success": true,
  "message": "PIN registrado correctamente",
  "pinId": "abc123",
  "expiresIn": 180
}
```

### Verificar Login

```http
POST /check-login
Content-Type: application/json

{
  "pin": "ABC123"
}
```

Verifica si un PIN ha sido autenticado.

**Respuestas:**

**Pendiente:**

```json
{
  "success": true,
  "verified": false,
  "message": "Login pendiente"
}
```

**Verificado:**

```json
{
  "success": true,
  "verified": true,
  "token": "eyJhbGciOiJIUzI1NiIs...",
  "refreshToken": "eyJhbGciOiJIUzI1NiIs...",
  "user": {
    "id": "123",
    "name": "Juan",
    "phone": "+1234567890",
    "roles": ["user"]
  }
}
```

### Webhook Evolution API

```http
POST /whatsapp-endpoint
Content-Type: application/json

{
  "event": "messages.upsert",
  "instance": "mi-instancia",
  "data": {
    "key": {
      "remoteJid": "1234567890@s.whatsapp.net",
      "fromMe": false
    },
    "pushName": "Usuario",
    "message": {
      "conversation": "PIN: üîêüîëüîí"
    }
  }
}
```

Recibe mensajes de WhatsApp desde Evolution API.

**Respuesta:** `200 OK`

### Refrescar Token

```http
POST /refresh-token
Authorization: Bearer {access_token}

{
  "id": "123"
}
```

Genera un nuevo token de acceso.

**Respuesta:**

```json
{
  "success": true,
  "token": "eyJhbGciOiJIUzI1NiIs...",
  "refreshToken": "eyJhbGciOiJIUzI1NiIs..."
}
```

### Obtener Perfil

```http
GET /profile
Authorization: Bearer {access_token}
```

Obtiene los datos del usuario autenticado.

**Respuesta:**

```json
{
  "success": true,
  "user": {
    "id": "123",
    "name": "Juan",
    "surname": "P√©rez",
    "phone": "+1234567890",
    "roles": ["user"]
  }
}
```

### Logout

```http
POST /logout
Authorization: Bearer {access_token}

{
  "id": "123"
}
```

Cierra la sesi√≥n del usuario.

**Respuesta:**

```json
{
  "success": true,
  "message": "Logout exitoso"
}
```

### Enviar mensaje WhatsApp

```http
POST /send-message
Authorization: Bearer {access_token}
Content-Type: application/json

{
  "phoneNumber": "+1234567890",
  "message": "Hola, tu c√≥digo es ABC123"
}
```

Env√≠a un mensaje de WhatsApp manualmente.

**Respuesta:**

```json
{
  "success": true,
  "message": "Mensaje enviado"
}
```

## WebSocket Events

### Cliente ‚Üí Servidor

```javascript
// Registrar PIN
socket.emit("register-pin", {
  pin: "ABC123",
  emojiString: "üîêüîëüîí",
});

// Cancelar autenticaci√≥n
socket.emit("cancel-auth", {
  pin: "ABC123",
});
```

### Servidor ‚Üí Cliente

```javascript
// PIN registrado
socket.on("pin-registered", (data) => {
  console.log("PIN registrado:", data.pinId);
});

// Autenticaci√≥n exitosa
socket.on("auth-success", (data) => {
  console.log("Token:", data.token);
  console.log("Usuario:", data.user);
});

// PIN expirado
socket.on("pin-expired", (data) => {
  console.log("PIN expirado:", data.pin);
});

// Error
socket.on("pin-error", (data) => {
  console.error("Error:", data.error);
});
```

## C√≥digos de error

| C√≥digo                  | HTTP | Descripci√≥n            |
| ----------------------- | ---- | ---------------------- |
| `PIN_EXPIRED`           | 410  | El PIN ha expirado     |
| `PIN_NOT_FOUND`         | 404  | PIN no existe          |
| `AUTHENTICATION_FAILED` | 401  | Autenticaci√≥n fallida  |
| `REFRESH_TOKEN_EXPIRED` | 401  | Refresh token expirado |
| `VALIDATION_ERROR`      | 400  | Datos inv√°lidos        |
| `NETWORK_ERROR`         | 503  | Error de red           |

## Descargar especificaci√≥n

- [swagger.yaml](https://github.com/camarauth/camarauth-sdk/blob/main/swagger.yaml)
- [swagger.json](https://github.com/camarauth/camarauth-sdk/blob/main/swagger.json)

## Postman Collection

<Card
  title="Importar a Postman"
  icon="download"
  href="https://raw.githubusercontent.com/camarauth/camarauth-sdk/main/postman-collection.json"
>
  Descarga la colecci√≥n de Postman lista para usar
</Card>
