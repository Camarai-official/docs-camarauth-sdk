---
title: "Migraci贸n"
description: "Gu铆a de migraci贸n entre versiones"
---

# Gu铆a de Migraci贸n

C贸mo migrar tu aplicaci贸n entre versiones de Camarauth SDK.

## Migraci贸n de v2 a v3

### Resumen de Cambios

<CardGroup cols={2}>
  <Card title="TypeScript" icon="code" color="#3178C6">
    Soporte completo de TypeScript con tipos incluidos
  </Card>
  
  <Card title="Arquitectura" icon="cube" color="#10B981">
    Arquitectura modular con separaci贸n de responsabilidades
  </Card>
  <Card title="Seguridad" icon="shield-check" color="#F59E0B">
    Mejor seguridad con rate limiting y validaci贸n de webhooks
  </Card>
  <Card title="Testing" icon="beaker" color="#8B5CF6">
    Tests exhaustivos incluidos
  </Card>
</CardGroup>

### Paso 1: Actualizar Dependencias

```bash
# Desinstalar versi贸n anterior
npm uninstall camarauth-lib

# Instalar nueva versi贸n
npm install camarauth-sdk@^3.0.0
```

### Paso 2: Actualizar Imports

<CodeGroup>

```typescript Antes (v2)
const { CamarauthClient } = require('camarauth-lib');
```

```typescript Despu茅s (v3)
import { CamarauthClient } from 'camarauth-sdk';
import { CamarauthBackend } from 'camarauth-sdk/backend';
import { usePinAuth } from 'camarauth-sdk/react';
```

</CodeGroup>

### Paso 3: Migrar Configuraci贸n del Backend

<CodeGroup>

```typescript Antes (v2)
const backend = new CamarauthBackend({
  dbConnection: pool, // Conexi贸n directa
  jwtSecret: process.env.JWT_SECRET
});
```

```typescript Despu茅s (v3)
import { PostgreSQLAdapter } from 'camarauth-sdk/backend';
import { Pool } from 'pg';

const pool = new Pool({
  connectionString: process.env.DATABASE_URL
});

const backend = new CamarauthBackend({
  db: new PostgreSQLAdapter(pool), // Usar adapter
  jwtSecret: process.env.JWT_SECRET!,
  // Nuevas opciones de seguridad
  rateLimit: { enabled: true, maxRequests: 100 },
  logger: createProductionLogger()
});
```

</CodeGroup>

### Paso 4: Migrar Hooks de React

<CodeGroup>

```typescript Antes (v2)
const { pin, status } = useCamarauth({
  apiUrl: 'http://localhost:3001'
});
```

```typescript Despu茅s (v3)
const {
  pin,
  emojiString,
  timeLeft,
  formattedTime,
  status,
  generate,
  cancel
} = usePinAuth({
  apiUrl: 'http://localhost:3001',
  whatsappNumber: '+34600123456',
  maxAutoRegenerations: 3
});
```

</CodeGroup>

### Paso 5: Manejo de Errores

<CodeGroup>

```typescript Antes (v2)
try {
  await backend.registerPin(pin);
} catch (error) {
  console.error(error.message);
}
```

```typescript Despu茅s (v3)
import { CamarauthError } from 'camarauth-sdk';

try {
  await backend.domainService.registerPin({ pin });
} catch (error) {
  if (error instanceof CamarauthError) {
    console.error(`Error ${error.code}: ${error.message}`);
    // Manejo espec铆fico por c贸digo de error
    switch (error.code) {
      case 'PIN_EXPIRED':
        // Manejar PIN expirado
        break;
      case 'RATE_LIMIT_EXCEEDED':
        // Manejar rate limit
        break;
    }
  }
}
```

</CodeGroup>

### Paso 6: Modelo de Usuario

<CodeGroup>

```typescript Antes (v2)
const user = {
  id: 123,
  first_name: 'Juan',
  phone: '+34600123456'
};
```

```typescript Despu茅s (v3)
import { mapDatabaseRowToUser } from 'camarauth-sdk/backend';

const user = mapDatabaseRowToUser({
  id: 123,
  nombre: 'Juan',      // o first_name
  telefono: '+34600123456'  // o phone
});

// Acceso a campos
console.log(user.nombre);     // 'Juan'
console.log(user.name);       // 'Juan' (alias)
console.log(user.telefono);   // '+34600123456'
console.log(user.phone);      // '+34600123456' (alias)
```

</CodeGroup>

### Paso 7: Webhooks

<CodeGroup>

```typescript Antes (v2)
app.post('/webhook', webhookHandler);
```

```typescript Despu茅s (v3)
import { createWebhookMiddleware } from 'camarauth-sdk/server';

app.post('/webhook/evolution', 
  createWebhookMiddleware({
    secret: process.env.WEBHOOK_SECRET,
    onMessage: async (message) => {
      // Procesar mensaje
    }
  })
);
```

</CodeGroup>

### Cambios Breaking

<AccordionGroup>
  
<Accordion title="Eliminado">
- `dbConnection`: Usar `DatabaseAdapter`
- Callbacks antiguos: Usar Promises/async-await
- Soporte Node.js < 18
</Accordion>

<Accordion title="Cambiado">
- Nombres de m茅todos: camelCase consistente
- Estructura de respuestas: `success: boolean` siempre presente
- C贸digos de error: Estandarizados
</Accordion>

<Accordion title="Nuevo">
- TypeScript obligatorio para tipos
- Rate limiting integrado
- Logs estructurados
- CI/CD pipeline
</Accordion>

</AccordionGroup>

### Checklist de Migraci贸n

- [ ] Actualizar package.json
- [ ] Migrar imports
- [ ] Actualizar configuraci贸n backend
- [ ] Migrar hooks React
- [ ] Actualizar manejo de errores
- [ ] Migrar modelo de usuario
- [ ] Actualizar webhooks
- [ ] Agregar tests
- [ ] Probar en desarrollo
- [ ] Desplegar a staging
- [ ] Desplegar a producci贸n

## Obtener Ayuda

-  [Documentaci贸n completa](/)
-  [Discusiones en GitHub](https://github.com/camarauth/sdk/discussions)
-  [Reportar issues](https://github.com/camarauth/sdk/issues)

## Ejemplos de Migraci贸n

Puedes apoyarte en estas gu铆as para migrar por bloques:

- [Quickstart Backend](/backend/quickstart)
- [Quickstart React](/react/quickstart)
- [Gu铆a de Testing](/guides/testing)
